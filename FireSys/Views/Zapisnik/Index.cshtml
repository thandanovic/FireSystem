@model IEnumerable<FireSys.Entities.Zapisnik>

@{
    ViewBag.Title = "Zapisnici";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    var selectedIDs;

    function OnSelectionChanged(s, e) {
        s.GetSelectedFieldValues("ZapisnikId", GetSelectedFieldValuesCallback);
    }
    function GetSelectedFieldValuesCallback(values) {
        //Capture all selected keys
        selectedIDs = values.join(',');
    }

    function UObradiClick(s, e) {
        mySpinner(true);
        setTimeout(function () {
            $.ajax({
                url: "@Url.Action("ChangeStatus", "Zapisnik")",
                data: { IDs: selectedIDs, status: 1 },
                method: "POST",
                dataType: "json"
            }).done(function (response) {
                window.location.reload();
                mySpinner(false);
            });

        }, 2000);

    }

    function ZavrsenClick(s, e) {
        mySpinner(true);
        setTimeout(function () {
            $.ajax({
                url: "@Url.Action("ChangeStatus", "Zapisnik")",
                data: { IDs: selectedIDs, status: 2 },
                method: "POST",
                dataType: "json"
            }).done(function (response) {
                window.location.reload();
                mySpinner(false);
            });

        }, 2000);
    }

    function OnClick(s, e) {
        var actionParams = $("form").attr("action").split("?OutputFormat=");
        actionParams[1] = s.GetMainElement().getAttribute("OutputFormatAttribute");
        $("form").attr("action", actionParams.join("?OutputFormat="));
    }

    function OnCreateClick(s, e) {
        $("#zapisnikModal").modal('show');
    }
    var commandName;
    function GridBeginCallback(s, e) {
        commandName = e.commandName;
        //Pass all selected keys to GridView callback action
        e.customArgs["selectedIDs"] = selectedIDs;
    }

    function GridEndCallback(s, e) {
        console.log(commandName);
        commandName = null;
    }

    $(function () {

        function deleteRow() {
            var txt;
            var r = confirm("Da li zelite obrisati?");
            if (r == true) {
                return true;
            } else {
                return false;
            }
        }

        AttachReport();
        $(document).ajaxComplete(function (event, request, settings) {
            if (settings.data !== undefined && settings.data.includes('zapisnikGrid')) {
                function deleteRow() {
                    var txt;
                    var r = confirm("Da li zelite obrisati?");
                    if (r == true) {
                        return true;
                    } else {
                        return false;
                    }
                }

                AttachReport();
            }
        });

    });

</script>

@using (Html.BeginForm("ExportTo", "Zapisnik"))
{

    <div class="action-container margin-bottom-20 pull-right">
        <table>
            <tr>
                <td>
                    @*@Html.ActionLink("Kreiraj novog klijenta", "Create", null, new { @class = "btn btn-primary" })*@
                    @Html.DevExpress().Button(btn =>
               {
                   btn.Name = "btnNewZapisnik";
                   btn.Text = "Kreiraj novi zapisnik";
                   //btn.RouteValues = new { Controller = "Zapisnik", Action = "Create", ParamValue = "" };
                   btn.ControlStyle.CssClass = "create-button";
                   btn.ClientSideEvents.Click = "OnCreateClick";
               }).GetHtml()
                </td>
                <td>
                    @Html.DevExpress().Button(settings =>
               {
                   settings.Name = "btnUObradi";
                   settings.Text = "U obradi";
                   settings.ControlStyle.CssClass = "yellowButton";
                   settings.ClientSideEvents.Click = "UObradiClick";
               }).GetHtml()
                </td>
                <td>
                    @Html.DevExpress().Button(settings =>
               {
                   settings.Name = "btnZavrsen";
                   settings.Text = "Završen";
                   settings.ControlStyle.CssClass = "greenButton";
                   settings.ClientSideEvents.Click = "ZavrsenClick";
               }).GetHtml()
                </td>
                <td>
                    @Html.DevExpress().Button(btn =>
           {
               btn.Name = "btnExportToPDF";
               btn.Attributes["OutputFormatAttribute"] = "PDF";
               btn.Text = "PDF";
               btn.UseSubmitBehavior = true;
               btn.ClientSideEvents.Click = "OnClick";
               btn.ControlStyle.CssClass = "export-button";
           }).GetHtml()
                </td>
                <td>
                    @Html.DevExpress().Button(btn =>
           {
               btn.Name = "btnExportToXLSX";
               btn.Attributes["OutputFormatAttribute"] = "XLSX";
               btn.Text = "EXCEL";
               btn.UseSubmitBehavior = true;
               btn.ClientSideEvents.Click = "OnClick";
               btn.ControlStyle.CssClass = "export-button";
           }).GetHtml()
                </td>
            </tr>
        </table>
    </div>

    <br />


    @Html.Partial("ZapisnikGridView", Model)

}
